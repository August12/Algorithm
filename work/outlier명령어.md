# Outliers

**outliers 명령어 문법 및 연동규격 설명서 입니다**

<br/>

### A. 개요

비정상적인 그룹을 찾아냅니다.

</br>

### B. 설명

Input으로 받은 Dataframe에 선택한 이상탐지 알고리즘으로 특정 임계값 범위를 벗어나는 값에 flag값을 붙여서 Dataframe을 반환합니다.

</br>

### C. Parameters

```
... | outlier target [alg=dbscan] [tolerance=0.3] [by=field_name]

... | outlier target [alg=mad] [tolerance=0.3] [by=field_name] [pct=0.1]
```

`target` : 분석할 데이터 필드명 입니다. **반드시** 지정해 줘야 합니다.

`alg` : **dbscan**,**mad**. 밀도기반 클러스리터링 알고리즘과 중앙값 편차를 이용하여 비정상적인 그룹을 찾아냅니다.

`tolerance` : 임계값 범위의 scale을 지정합니다. 위의 수식에 값의 범위를 늘리는 데 사용 합니다. 기본값 = 2.

`by` : 그룹으로 각각의 비정상그룹을 탐지할 수 있습니다. 기본값 = None

### D. Examples

- 데이터가 다음과 같이 존재합니다.

|  **DATETIME_10M**  | **HOST**  | **CNT** |
| :----------------: | :-------: | :-----: |
| **20181103075000** | hadoop02  |    1    |
| **20181102141000** | hadoop02  |    1    |
| **20181103091000** | hadoop02  |    1    |
|        ...         |    ...    |   ...   |
| **20181102123000** |   gcs4    |    3    |
| **20181102103000** |   gcs3    |    3    |
| **20181103055000** |   gcs5    |    3    |
|        ...         |    ...    |   ...   |
| **20181103043000** |   gcs1    |  4292   |
| **20181103025000** |   gcs1    |  4296   |
| **20181102124000** |   gcs1    |  4292   |
|        ...         |    ...    |   ...   |
| **20181102195000** | tsdn-svr1 |  10793  |
| **20181103052000** | tsdn-svr1 |  10568  |
| **20181103001000** | tsdn-svr1 |  10890  |
|        ...         |    ...    |   ...   |

<br/>

- dbscan 결과 (위 예시데이터 사용)

  ~~~
  ... | outlier CNT alg=dbscan by=HOST
  ~~~

  #### **test_outlier에 test_case3 참고**

  **HOST**들 중에서 이상한 **HOST**는 **gcs1**과 **tsdn-svr1**로 판단됩니다.
  **한 번**이라도 **이상한 행동**을 보인 HOST들을 잡아냅니다.

  그러나, 대체적으로 정상적으로 활동하나 특정 시간에 이상한 경우에는 이상한 HOST로 분류하는 데에 무리가 있습니다.
  따라서 mad 알고리즘을 사용하여 더 정확하게 검사할 수 있습니다.

- mad 결과 (위 예시데이터 사용)

  ~~~
  ... | outlier CNT alg=mad by=HOST
  ~~~

  #### **test_outlier에 test_case3, test_case4 참고**

  mad 알고리즘은 각각의 **HOST** 끼리 검사를 진행합니다. anomalies랑 유사합니다. 그러나 중앙값을 이용해서 이상한 값을 찾아냅니다. pct 비율을 넘어가는 이상한 값이 검출된다면, 이상한 **HOST**로 판단합니다.

  빈 데이터 프레임이 반환됩니다.

  따라서 **tsdn-svr1**은 CNT 값의 분포가 일정하지않으므로 이상한 **HOST**로 판단해서는 안됩니다.

  **gcs1** 또한 이상하다고 검출되진 않으나, CNT 값의 분포가 일정하므로 mad로 판단할 순 없습니다. 따라서, dbscan에 의해 **gcs1**만이 위 예시 데이터에서 이상한 **HOST**입니다.

